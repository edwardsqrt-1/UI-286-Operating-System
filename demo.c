/*
 * Program: UI(286) Demo Software
 * Author: Edward Bierens
 * Date Created: Wednesday November 26th, 2025
 * 
 * Description: This is just a demo program that displays UI(286)
 * in big characters on a rainbow background. Meant to show off the
 * graphics, time, and sound functions in the UI(286) library
 * 
 */

#include <string.h>
#include <textmode.h>
#include <time.h>
#include <speaker.h>

// Table for the character and attribute bytes for a rainbow
char rainbow[9][2] = {
    {0x00, 0x4C},
    {0xDB, 0x4C},
    {0xB1, 0x4E},
    {0xDB, 0x6E},
    {0xDB, 0x2A},
    {0xDB, 0x3B},
    {0xB1, 0x1C},
    {0xDB, 0x19},
    {0xB1, 0x19}
};

// Big character 'U'
char U[5][6] = {
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0x20,0xDB,0xDB,0xDB,0x20,0x00}
};

// Big character 'I'
char I[5][6] = {
    {0xDB,0xDB,0xDB,0xDB,0xDB,0x0D},
    {0x20,0x20,0xDB,0x20,0x20,0x0D},
    {0x20,0x20,0xDB,0x20,0x20,0x0D},
    {0x20,0x20,0xDB,0x20,0x20,0x0D},
    {0xDB,0xDB,0xDB,0xDB,0xDB,0x00}
};

// Big character '('
char LP[5][6] = {
    {0x20,0x20,0xDB,0x20,0x20,0x0D},
    {0x20,0xDB,0x20,0x20,0x20,0x0D},
    {0x20,0xDB,0x20,0x20,0x20,0x0D},
    {0x20,0xDB,0x20,0x20,0x20,0x0D},
    {0x20,0x20,0xDB,0x20,0x20,0x00},
};

// Big character '2'
char TWO[5][6] = {
    {0xDB,0xDB,0xDB,0xDB,0x20,0x0D},
    {0x20,0x20,0x20,0x20,0xDB,0x0D},
    {0x20,0xDB,0xDB,0xDB,0x20,0x0D},
    {0xDB,0x20,0x20,0x20,0x20,0x0D},
    {0xDB,0xDB,0xDB,0xDB,0xDB,0x00}
};

// Big character '8'
char EIGHT[5][6] = {
    {0x20,0xDB,0xDB,0xDB,0x20,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0x20,0xDB,0xDB,0xDB,0x20,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0x20,0xDB,0xDB,0xDB,0x20,0x00}
};

// Big character '6'
char SIX[5][6] = {
    {0x20,0xDB,0xDB,0xDB,0x20,0x0D},
    {0xDB,0x20,0x20,0x20,0x20,0x0D},
    {0xDB,0xDB,0xDB,0xDB,0x20,0x0D},
    {0xDB,0x20,0x20,0x20,0xDB,0x0D},
    {0x20,0xDB,0xDB,0xDB,0x20,0x00}
};

// Big character ')'
char RP[5][6] = {
    {0x20,0x20,0xDB,0x20,0x20,0x0D},
    {0x20,0x20,0x20,0xDB,0x20,0x0D},
    {0x20,0x20,0x20,0xDB,0x20,0x0D},
    {0x20,0x20,0x20,0xDB,0x20,0x0D},
    {0x20,0x20,0xDB,0x20,0x20,0x00}
};

// Entry point (do not modify, copy and paste this to the beginning of your program after your includes)
void main();
void __far entrypoint() {

    // Set the data segment
    __asm {
        mov ax, 0x1500
        mov ds, ax
    }

    // Call the program's main function
    main();

    // Exit back into the kernel
    return;
}

// Print a big character as shown above
void PrintBigChar(char big_c[5][6], unsigned char x, unsigned char y, unsigned char attr) {

    // Initialize row and column variables
    unsigned char r,c;
    c = 0;
    r = 0;

    // If carriage return is found, go to next line. Otherwise print (but ignore spaces)
    while (big_c[r][c] != 0) {
        if (big_c[r][c] == 0x0D) { // Carriage Return
            r++;
            c = 0;
        } else if (big_c[r][c] == ' ') { // Space
            c++;
        } else { // Any other character
            TM_PutChar(big_c[r][c], x+c, y+r, attr);
            c++;
        }
    }

}

// Main program code
void main() {

    // Initialize temporary variables
    unsigned char x,y,i;
    unsigned short freq;

    // Create vertical stripes 
    i = 0;
    for (x = 0; x < TM_WIDTH; x++) {
        for (y = 0; y < TM_HEIGHT; y++) {
            TM_PutChar(rainbow[i][0], x, y, rainbow[i][1]);
        }
        for (freq = 500; freq <= 1000; freq += 100) beep(freq, 5000);
        delay(25000);
        i = (i + 1) % 9;
    }

    // Create a black box with grey outline near the center
    for (x = 17; x <= 60; x++) {
        for (y = 8; y <= 16; y++) {
            if (x == 17 || x == 60 || y == 8 || y == 16) TM_ClearChar(x, y, 0x70);
            else TM_ClearChar(x, y, 0x10);
        }
    }

    // Print out "UI(286)" with the large letters
    PrintBigChar(U, 19, 10, 0x0C);
    PrintBigChar(I, 26, 10, 0x0C);
    PrintBigChar(LP, 32, 10, 0x0F);
    PrintBigChar(TWO, 38, 10, 0x0B);
    PrintBigChar(EIGHT, 44, 10, 0x0B);
    PrintBigChar(SIX, 50, 10, 0x0B);
    PrintBigChar(RP, 55, 10, 0x0F);

    // Delay for 2 seconds before prompting for a key
    delay(2000000);

    // Clear bottom bar and ask for a key to continue
    for (x = 0; x < TM_WIDTH; x++) TM_ClearChar(x, TM_HEIGHT-1, 0x00);
    TM_PutStr("Press any key to continue...", 0, TM_HEIGHT-1, 0x0F);
    GetChar_H();

}
